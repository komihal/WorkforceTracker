# Исправления для фоновой отправки данных

## Проблема
В фоновом режиме данные собирались, но не отправлялись на сервер.

## Причины
1. **BackgroundService инициализировался только при начале смены**
2. **Сбор геоданных работал только в активном режиме**
3. **Отсутствовала интеграция между BackgroundGeolocation и BackgroundService**

## Исправления

### 1. App.js
- Добавлена инициализация BackgroundService при запуске приложения
- BackgroundService инициализируется для существующих и новых пользователей
- Импортирован backgroundService

### 2. backgroundService.js
- Убрана проверка `appState === 'active'` для сбора геоданных
- Сбор данных теперь работает всегда, включая фоновый режим
- Добавлен метод `backgroundUpload()` для фоновой отправки
- В фоновом режиме данные автоматически отправляются на сервер

### 3. location.js
- Добавлена интеграция с BackgroundService
- Данные из BackgroundGeolocation теперь кэшируются в BackgroundService
- Обеспечена двойная отправка: прямая + через BackgroundService

## Как это работает теперь

1. **При запуске приложения**:
   - Инициализируется BackgroundGeolocation
   - Инициализируется BackgroundService (если есть пользователь)

2. **В активном режиме**:
   - Данные собираются через интервал
   - Данные отправляются через интервал
   - BackgroundGeolocation отправляет данные напрямую

3. **В фоновом режиме**:
   - Данные собираются через BackgroundGeolocation
   - Данные кэшируются в BackgroundService
   - Данные автоматически отправляются каждые 15 сек (тест) / 60 сек (продакшн)

## Тестирование

1. Запустите приложение
2. Войдите в систему
3. Переведите приложение в фон
4. Проверьте логи - должны появиться сообщения:
   - "Background geo collection scheduled in 15 seconds"
   - "Background upload triggered - X geo points"
   - "Background geo data upload successful!"

## Настройки

- **Тестовый режим**: сбор каждые 30 сек, отправка каждые 2 мин
- **Продакшн режим**: сбор каждые 2 мин, отправка каждые 10 мин
- **Фоновый режим**: сбор каждые 15 сек (тест) / 60 сек (продакшн)
