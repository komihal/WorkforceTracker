# Конфигурация частоты геолокации

## Обзор

Система геолокации теперь поддерживает разные частоты сбора и отправки данных в зависимости от режима работы приложения:

- **Тестовый режим** (`__DEV__ = true`): Частая отправка для отладки
- **Продакшн режим** (`__DEV__ = false`): Оптимизированная частота для экономии батареи

## Настройки по режимам

### Тестовый режим (Debug/Development)
- **Активный интервал**: 10 секунд
- **Фоновый интервал**: 10 секунд  
- **Интервал отправки**: 30 секунд
- **Дистанционный фильтр**: 5 метров
- **Heartbeat интервал**: 10 секунд
- **Максимальный возраст позиции**: 5 секунд

### Продакшн режим (Production)
- **Активный интервал**: 60 секунд (1 минута)
- **Фоновый интервал**: 60 секунд (1 минута)
- **Интервал отправки**: 300 секунд (5 минут)
- **Дистанционный фильтр**: 50 метров
- **Heartbeat интервал**: 60 секунд
- **Максимальный возраст позиции**: 30 секунд

## Файлы конфигурации

### `src/config/geoConfig.js`
Основной файл конфигурации, содержащий настройки для обоих режимов.

**Функции:**
- `getGeoConfig()` - автоматически определяет режим по `__DEV__`
- `getGeoConfigByMode(isTestMode)` - возвращает конфигурацию для указанного режима

### Обновленные файлы

1. **`src/location.js`**
   - Использует `getGeoConfig()` для настройки BackgroundGeolocation
   - Настраивает `distanceFilter`, `heartbeatInterval`, `stopTimeout` в зависимости от режима
   - Обновляет текст уведомления для различения режимов

2. **`src/services/backgroundService.js`**
   - Использует `getGeoConfigByMode()` для настройки интервалов
   - Настраивает частоту сбора геоданных в активном и фоновом режимах
   - Обновляет статистику для отображения текущих интервалов

3. **`src/services/geoService.js`**
   - Использует `getGeoConfig()` для настройки `maximumAge` при получении позиции
   - Логирует текущий режим для отладки

## Как это работает

### Автоматическое определение режима
```javascript
// В React Native приложении
const config = getGeoConfig(); // Автоматически использует __DEV__

// Ручное указание режима
const testConfig = getGeoConfigByMode(true);  // Тестовый режим
const prodConfig = getGeoConfigByMode(false); // Продакшн режим
```

### Инициализация в App.js
```javascript
await backgroundService.initialize(
  user.user_id,
  1, // place_id
  '123456789012345', // IMEI
  __DEV__ // тестовый режим автоматически определяется
);
```

## Логирование

Система логирует текущую конфигурацию при инициализации:

```
Initializing BackgroundGeolocation with config: {
  mode: 'TEST',
  distanceFilter: 5,
  heartbeatInterval: 10,
  stopTimeout: 0
}
```

## Статистика

BackgroundService теперь предоставляет расширенную статистику:

```javascript
const stats = backgroundService.getStats();
console.log(stats);
// {
//   pendingPhotos: 0,
//   pendingGeoData: 5,
//   isRunning: true,
//   isTestMode: true,
//   geoInterval: 10,           // Активный интервал (сек)
//   backgroundGeoInterval: 10, // Фоновый интервал (сек)
//   uploadInterval: 30,        // Интервал отправки (сек)
//   distanceFilter: 5,         // Дистанционный фильтр (м)
//   heartbeatInterval: 10      // Heartbeat интервал (сек)
// }
```

## Изменение настроек

Для изменения частоты геолокации отредактируйте файл `src/config/geoConfig.js`:

```javascript
export const GEO_CONFIG = {
  TEST_MODE: {
    ACTIVE_INTERVAL: 10 * 1000,    // Изменить здесь
    BACKGROUND_INTERVAL: 10 * 1000, // Изменить здесь
    // ... другие настройки
  },
  PRODUCTION_MODE: {
    ACTIVE_INTERVAL: 60 * 1000,    // Изменить здесь
    BACKGROUND_INTERVAL: 60 * 1000, // Изменить здесь
    // ... другие настройки
  }
};
```

## Тестирование

Для тестирования конфигурации:

1. **В режиме разработки** (`npm run android` или `npm run ios`):
   - Геолокация будет отправляться каждые 10 секунд
   - Уведомление покажет "Тестовый режим - частое отслеживание"

2. **В продакшн режиме** (собранное приложение):
   - Геолокация будет отправляться каждую минуту
   - Уведомление покажет "Отслеживание местоположения активно"

## Совместимость

- Все изменения обратно совместимы
- Существующий код продолжит работать без изменений
- Новые настройки применяются автоматически при перезапуске приложения
