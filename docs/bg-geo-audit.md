# Background Geolocation Audit Report

## 1. Overview

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: `react-native-background-geolocation` (Transistorsoft) v4.x  
**–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏**: ‚ùå –ù–ï–¢ - –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏  
**–°—Ç–∞—Ç—É—Å**: –°–ª–æ–∂–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ–º –∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º–∏ –ø—Ä–æ–±–ª–µ–º–∞–º–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BGGeo –≤ `location.js` –∏ `backgroundService.js`
- –°–º–µ—à–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ HTTP-–≤—ã–∑–æ–≤—ã + –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –µ–¥–∏–Ω–æ–π —Ç–æ—á–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã –∏ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã

## 2. –§–∞–π–ª—ã –∏ —Ç–æ—á–∫–∏ –≤—Ö–æ–¥–∞

### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏:
- **`src/location.js`** (941 —Å—Ç—Ä–æ–∫–∞) - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BGGeo, –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
- **`src/services/backgroundService.js`** (543 —Å—Ç—Ä–æ–∫–∏) - –¥—É–±–ª–∏—Ä—É—é—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BGGeo
- **`src/config/geoConfig.js`** (61 —Å—Ç—Ä–æ–∫–∞) - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤ –∏ —Ç–æ—á–Ω–æ—Å—Ç–∏
- **`src/config/geoEndpointConfig.js`** (75 —Å—Ç—Ä–æ–∫) - –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É API/webhook
- **`src/api.js`** - —Ñ—É–Ω–∫—Ü–∏—è `postLocation()` –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö
- **`src/services/geoService.js`** - –ª–æ–∫–∞–ª—å–Ω–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö

### –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞:
1. **App.js** ‚Üí `initLocation()` (—Å—Ç—Ä–æ–∫–∞ 174 –≤ location.js)
2. **MainScreen.js** ‚Üí `startTracking()`/`stopTracking()` (—Å—Ç—Ä–æ–∫–∏ 879-907)
3. **BackgroundService** ‚Üí `initializeBackgroundGeolocation()` (—Å—Ç—Ä–æ–∫–∞ 45)

## 3. –ü–æ—Ç–æ–∫ —Å–æ–±—ã—Ç–∏–π

```mermaid
graph TD
    A[App Start] --> B[initLocation]
    B --> C[BGGeo.ready]
    C --> D[Setup Listeners]
    D --> E[onLocation]
    D --> F[onHeartbeat]
    D --> G[onSync]
    E --> H[postLocation API]
    F --> H
    G --> I[Native Uploader]
    H --> J[Django API]
    I --> J
    
    K[BackgroundService] --> L[initializeBackgroundGeolocation]
    L --> M[BGGeo.start]
    M --> N[Duplicate Listeners]
```

### –ü—Å–µ–≤–¥–æ–∫–æ–¥ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
```javascript
// location.js:174
export async function initLocation() {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π
  // 2. –ß—Ç–µ–Ω–∏–µ –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏–∑ .env
  // 3. BGGeo.ready() —Å –ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
  // 4. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ (onLocation, onHeartbeat, onSync)
  // 5. –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è headless task
  // 6. –ó–∞–ø—É—Å–∫ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏
}

// backgroundService.js:45
async initializeBackgroundGeolocation() {
  // –î–£–ë–õ–ò–†–û–í–ê–ù–ò–ï: –ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BGGeo
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ –∑–∞–ø—É—Å–∫
}
```

## 4. HTTP-–æ—Ç–ø—Ä–∞–≤–∫–∞

### –î–≤–æ–π–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:

**1. –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ HTTP-–≤—ã–∑–æ–≤—ã (–æ—Å–Ω–æ–≤–Ω–æ–π –ø—É—Ç—å):**
```javascript
// location.js:286-397 (onLocation)
// location.js:427-513 (onHeartbeat)
await postLocation({
  lat: c.latitude,
  lon: c.longitude,
  accuracy: c.accuracy,
  // ... –¥—Ä—É–≥–∏–µ –ø–æ–ª—è
});
```

**2. –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader BGGeo (–Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è):**
```javascript
// location.js:549-599
autoSync: true,
batchSync: true,
syncUrl: `${API_CONFIG.BASE_URL}/db_save/`,
syncThreshold: 1,
httpTimeout: 30000,
params: { api_token: API_CONFIG.API_TOKEN },
headers: { 'Authorization': `Bearer ${API_CONFIG.API_TOKEN}` },
transform: (location) => { /* —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö */ }
```

### –ü–æ–≤–µ–¥–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ñ—Ñ–ª–∞–π–Ω–µ:
- **–°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –≤—ã–∑–æ–≤—ã**: –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—Ñ—Ñ–ª–∞–π–Ω–∞, –¥–∞–Ω–Ω—ã–µ —Ç–µ—Ä—è—é—Ç—Å—è
- **–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader**: –ù–∞—Å—Ç—Ä–æ–µ–Ω `maxRecordsToPersist: 1000`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

## 5. –ü—Ä–∞–≤–∞ –∏ –º–∞–Ω–∏—Ñ–µ—Å—Ç—ã

### Android (AndroidManifest.xml):
| –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|-------------|
| `ACCESS_FINE_LOCATION` | ‚úÖ | –ï—Å—Ç—å |
| `ACCESS_COARSE_LOCATION` | ‚úÖ | –ï—Å—Ç—å |
| `ACCESS_BACKGROUND_LOCATION` | ‚úÖ | –ï—Å—Ç—å |
| `FOREGROUND_SERVICE` | ‚úÖ | –ï—Å—Ç—å |
| `POST_NOTIFICATIONS` | ‚úÖ | –ï—Å—Ç—å |
| `WAKE_LOCK` | ‚úÖ | –ï—Å—Ç—å |
| `RECEIVE_BOOT_COMPLETED` | ‚úÖ | –ï—Å—Ç—å |
| `REQUEST_IGNORE_BATTERY_OPTIMIZATIONS` | ‚úÖ | –ï—Å—Ç—å |

### iOS (Info.plist):
| –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ | –°—Ç–∞—Ç—É—Å | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|------------|--------|-------------|
| `NSLocationWhenInUseUsageDescription` | ‚úÖ | –ï—Å—Ç—å |
| `NSLocationAlwaysAndWhenInUseUsageDescription` | ‚úÖ | –ï—Å—Ç—å |
| `UIBackgroundModes: location` | ‚úÖ | –ï—Å—Ç—å |

### –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:
- ‚ùå `NSMotionUsageDescription` - –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è
- ‚ùå `UIBackgroundModes: processing` - –¥–ª—è —Ñ–æ–Ω–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## 6. –§–æ–Ω –∏ –∂–∏–≤—É—á–µ—Å—Ç—å

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏:
```javascript
// location.js:539-668
stopOnTerminate: false,        // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
startOnBoot: true,             // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ  
enableHeadless: true,          // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
foregroundService: true,        // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ
preventSuspend: true,          // ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (iOS)
heartbeatInterval: 10,         // ‚ö†Ô∏è –ß–∞—Å—Ç–æ (10 —Å–µ–∫)
```

### –ü—Ä–æ–±–ª–µ–º—ã:
- **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫**: `stopOnTerminate` –∏ `startOnBoot` —É–∫–∞–∑–∞–Ω—ã –¥–≤–∞–∂–¥—ã (—Å—Ç—Ä–æ–∫–∏ 539, 611, 651)
- **–ß–∞—Å—Ç—ã–π heartbeat**: 10 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç —Ä–∞–∑—Ä—è–∂–∞—Ç—å –±–∞—Ç–∞—Ä–µ—é
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `requestIgnoreBatteryOptimizations()`**: –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –¥–ª—è Android

## 7. –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ—á–Ω–æ—Å—Ç–∏ –∏ –±–∞—Ç–∞—Ä–µ–∏

### –¢–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è:
```javascript
// geoConfig.js:4-49
TEST_MODE: {
  DISTANCE_FILTER: 1,           // ‚ö†Ô∏è –û—á–µ–Ω—å —á–∞—Å—Ç–æ (1 –º–µ—Ç—Ä)
  HEARTBEAT_INTERVAL: 10,       // ‚ö†Ô∏è –ß–∞—Å—Ç–æ (10 —Å–µ–∫)
  STOP_TIMEOUT: 0,              // ‚úÖ –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
  MAX_AGE: 2000,               // ‚úÖ –°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ (2 —Å–µ–∫)
}

PRODUCTION_MODE: {
  DISTANCE_FILTER: 1,           // ‚ö†Ô∏è –û—á–µ–Ω—å —á–∞—Å—Ç–æ (1 –º–µ—Ç—Ä)
  HEARTBEAT_INTERVAL: 10,       // ‚ö†Ô∏è –ß–∞—Å—Ç–æ (10 —Å–µ–∫)
  STOP_TIMEOUT: 0,              // ‚úÖ –ù–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è
  MAX_AGE: 2000,               // ‚úÖ –°–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ (2 —Å–µ–∫)
}
```

### –ü—Ä–æ–±–ª–µ–º—ã:
- **–°–ª–∏—à–∫–æ–º —á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**: 1 –º–µ—Ç—Ä + 10 —Å–µ–∫ = –≤—ã—Å–æ–∫–∞—è –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –±–∞—Ç–∞—Ä–µ—é
- **–û–¥–∏–Ω–∞–∫–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: TEST –∏ PRODUCTION —Ä–µ–∂–∏–º—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã

## 8. –î—É–±–ª–∏ –∏ –∞–Ω—Ç–∏-–ø–∞—Ç—Ç–µ—Ä–Ω—ã

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã:

**1. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ BGGeo:**
```javascript
// location.js:174 - –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
export async function initLocation() { /* ... */ }

// backgroundService.js:45 - –¥—É–±–ª–∏—Ä—É—é—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è  
async initializeBackgroundGeolocation() { /* ... */ }
```

**2. –°–º–µ—à–∞–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:**
- –°–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ HTTP-–≤—ã–∑–æ–≤—ã –≤ `onLocation`/`onHeartbeat`
- –ù–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π, –Ω–æ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader
- –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –æ—Ç–ø—Ä–∞–≤–∫–∏

**3. –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∞–π–º–µ—Ä—ã:**
```javascript
// location.js:770 - –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
startPeriodicLocationSend() { setInterval(/* ... */) }

// backgroundService.js - —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã
this.intervalId = setInterval(/* ... */)
this.uploadIntervalId = setInterval(/* ... */)
```

**4. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ headless task –≤ backgroundService:**
```javascript
// location.js:698 - headless task –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
await BGGeo.registerHeadlessTask(async (event) => { /* ... */ });

// backgroundService.js - headless task –ù–ï –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω
// "Headless Task —É–∂–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ location.js" - –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
```

**5. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö API:**
- ‚ùå –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `navigator.geolocation` (—Ö–æ—Ä–æ—à–æ)
- ‚ùå –ù–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è `@react-native-community/geolocation` (—Ö–æ—Ä–æ—à–æ)

## 9. ENV-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

### –ß–∏—Ç–∞–µ–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
```javascript
// location.js:232-258
const platform = Platform.OS;
currentEnvVarName = platform === 'ios' ? 'BG_GEO_LICENSE_IOS' : 'BG_GEO_LICENSE_ANDROID';

// –ß—Ç–µ–Ω–∏–µ —á–µ—Ä–µ–∑ react-native-config
const Config = require('react-native-config').default;
license = Config.BG_GEO_LICENSE_ANDROID || Config.BG_GEO_LICENSE_IOS;
```

### Fallback –∑–Ω–∞—á–µ–Ω–∏—è:
```javascript
// location.js:245-248
if (!license && Platform.OS === 'android') {
  license = '7d1976aa376fbcf7e40d12892c8dab579985abbcbc09e1da570826649b4295cf';
}
```

### Android build.gradle:
```gradle
// android/app/build.gradle:100-102
manifestPlaceholders = [
  BG_GEO_LICENSE_ANDROID: project.env.get("BG_GEO_LICENSE_ANDROID") ?: '7d1976aa376fbcf7e40d12892c8dab579985abbcbc09e1da570826649b4295cf'
]
```

## 10. –†–∏—Å–∫–∏/—Å–∏–º–ø—Ç–æ–º—ã ¬´–∑–∞—Ç—É—Ö–∞–Ω–∏–π¬ª

### –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Ç—Ä–µ–∫–∏–Ω–≥–∞:

**1. –ö–æ–Ω—Ñ–ª–∏–∫—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–π (location.js:174 + backgroundService.js:45):**
- –î–≤–∞ —Å–µ—Ä–≤–∏—Å–∞ –ø—ã—Ç–∞—é—Ç—Å—è —É–ø—Ä–∞–≤–ª—è—Ç—å –æ–¥–Ω–∏–º BGGeo
- –í–æ–∑–º–æ–∂–Ω—ã race conditions –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ/—Å—Ç–æ–ø–µ

**2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏:**
```javascript
// location.js:380-382
} catch (error) {
  console.error(`Error sending location via postLocation API:`, error.message);
  // –ù–ï–¢ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∏–ª–∏ –æ—á–µ—Ä–µ–¥–∏
}
```

**3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –∞–∫—Ç–∏–≤–Ω–æ–π —Å–º–µ–Ω—ã:**
```javascript
// location.js:293-297
const hasActiveShift = await checkActiveShift();
if (!hasActiveShift) {
  console.log('onLocation suppressed: no active shift');
  return; // –û–°–¢–ê–ù–û–í–ö–ê –æ—Ç–ø—Ä–∞–≤–∫–∏
}
```

**4. –ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ä–∞–∑—Ä—è–∂–∞—é—Ç –±–∞—Ç–∞—Ä–µ—é:**
- `distanceFilter: 1` –º–µ—Ç—Ä
- `heartbeatInterval: 10` —Å–µ–∫—É–Ω–¥
- Android –º–æ–∂–µ—Ç —É–±–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±–∞—Ç–∞—Ä–µ–∏

**5. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ `requestIgnoreBatteryOptimizations()`:**
- Android Doze —Ä–µ–∂–∏–º –º–æ–∂–µ—Ç –∑–∞–º–æ—Ä–æ–∑–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- OEM-–∫–∏–ª–ª–µ—Ä—ã –º–æ–≥—É—Ç –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–µ —Å–µ—Ä–≤–∏—Å—ã

## 11. –°–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤ –∫ –∞–≤—Ç–æ—Ä—É

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:

1. **–°—Ç—Ä–æ–∫–∞ 45 –≤ backgroundService.js**: –ó–∞—á–µ–º –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è BGGeo? –≠—Ç–æ —Å–æ–∑–¥–∞–µ—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã.

2. **–°—Ç—Ä–æ–∫–∞ 549 –≤ location.js**: –ü–æ—á–µ–º—É –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader, –Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ `postLocation()`?

3. **–°—Ç—Ä–æ–∫–∞ 1 –≤ geoConfig.js**: –ü–æ—á–µ–º—É TEST –∏ PRODUCTION —Ä–µ–∂–∏–º—ã –∏–¥–µ–Ω—Ç–∏—á–Ω—ã? –ù—É–∂–Ω—ã –ª–∏ —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏?

4. **–°—Ç—Ä–æ–∫–∞ 770 –≤ location.js**: –ó–∞—á–µ–º –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞, –µ—Å–ª–∏ –µ—Å—Ç—å `onLocation` –∏ `onHeartbeat`?

5. **–°—Ç—Ä–æ–∫–∞ 293 –≤ location.js**: –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç, –µ—Å–ª–∏ API `/api/active-shift/` –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω? –°–º–µ–Ω–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ–π?

6. **–°—Ç—Ä–æ–∫–∞ 245 –≤ location.js**: –•–∞—Ä–¥–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ª–∏—Ü–µ–Ω–∑–∏—è –≤ –∫–æ–¥–µ - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞?

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã:

7. **–°—Ç—Ä–æ–∫–∞ 608 –≤ location.js**: `preventSuspend: true` —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ iOS. –ù—É–∂–Ω–∞ –ª–∏ –∞–Ω–∞–ª–æ–≥–∏—á–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è Android?

8. **–°—Ç—Ä–æ–∫–∞ 43 –≤ AndroidManifest.xml**: –õ–∏—Ü–µ–Ω–∑–∏—è –≤ –º–∞–Ω–∏—Ñ–µ—Å—Ç–µ —Å–æ–≤–ø–∞–¥–∞–µ—Ç —Å —Ö–∞—Ä–¥–∫–æ–¥–æ–º –≤ –∫–æ–¥–µ. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ?

9. **–°—Ç—Ä–æ–∫–∞ 36 –≤ Info.plist**: –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç `NSMotionUsageDescription`. –ù—É–∂–Ω–æ –ª–∏ –¥–ª—è –¥–µ—Ç–µ–∫—Ü–∏–∏ –¥–≤–∏–∂–µ–Ω–∏—è?

10. **–°—Ç—Ä–æ–∫–∞ 102 –≤ api.js**: –ü–æ—á–µ–º—É `place_id: 1` –∏ `phone_imei: "123456789012345"` —Ö–∞—Ä–¥–∫–æ–¥—è—Ç—Å—è?

## 12. –ö–æ—Ä–æ—Ç–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏:

- **–£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£–¥–∞–ª–∏—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é BGGeo –∏–∑ `backgroundService.js`
- **–ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π uploader BGGeo
- **–£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã**: `distanceFilter: 10`, `heartbeatInterval: 30`
- **–î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫**: Retry –ª–æ–≥–∏–∫–∞ –¥–ª—è —Å–µ—Ç–µ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- **–í—ã–∑–≤–∞—Ç—å `requestIgnoreBatteryOptimizations()`**: –î–ª—è Android
- **–£–±—Ä–∞—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è BGGeo
- **–†–∞–∑–¥–µ–ª–∏—Ç—å TEST/PRODUCTION**: –†–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤
- **–î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥**: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è BGGeo –∏ –æ—à–∏–±–æ–∫

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:
1. üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**: –£–±—Ä–∞—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
2. üî¥ **–ö—Ä–∏—Ç–∏—á–Ω–æ**: –ö–æ–Ω—Å–æ–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –æ—Ç–ø—Ä–∞–≤–∫–∏  
3. üü° **–í–∞–∂–Ω–æ**: –£–≤–µ–ª–∏—á–∏—Ç—å –∏–Ω—Ç–µ—Ä–≤–∞–ª—ã –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –±–∞—Ç–∞—Ä–µ–∏
4. üü° **–í–∞–∂–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫ —Å–µ—Ç–∏
5. üü¢ **–ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ**: –†–∞–∑–¥–µ–ª–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ TEST/PRODUCTION
