# –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π —Å–ø–∞–º–∞ –ø–æ–ª–ª–µ—Ä–∞

## üéØ –¶–µ–ª–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

1. **–£—Å—Ç—Ä–∞–Ω–∏—Ç—å —Å–ø–∞–º API** (200-300–º—Å) ‚Üí single-instance –ø–æ–ª–ª–µ—Ä —Å–æ —Å—Ç—Ä–æ–≥–∏–º–∏ –ª–∏–º–∏—Ç–∞–º–∏
2. **–ù–µ –¥–æ–ø—É—Å–∫–∞—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤** –ø—Ä–∏ —Ä–µ-—Ä–µ–Ω–¥–µ—Ä–∞—Ö/—Ñ–æ–∫—É—Å–µ
3. **–û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –≤—ã–∑–æ–≤—ã –∏–∑ onHeartbeat** —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–æ–º
4. **–Ø–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å/—Å—Ç–∞—Ä—Ç–æ–≤–∞—Ç—å BG** –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ä–µ–∂–∏–º–µ

## üîß –í–Ω–µ—Å–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Single-instance –ø–æ–ª–ª–µ—Ä —Å—Ç–∞—Ç—É—Å–∞ —Å–º–µ–Ω—ã
- **–§–∞–π–ª**: `src/services/shiftStatusService.js`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**:
  - –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø–æ–ª–ª–µ—Ä —Å —Ç—Ä–æ—Ç—Ç–ª–∏–Ω–≥–æ–º (15s –º–∏–Ω–∏–º—É–º)
  - Guard –æ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–≤
  - Backoff –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö (30s)
  - Timeout –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ (10s)

### 2. –£—Ç–∏–ª–∏—Ç–∞ fetchWithTimeout
- **–§–∞–π–ª**: `src/utils/net.ts`
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ë–µ–∑–æ–ø–∞—Å–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã —Å —Ç–∞–π–º–∞—É—Ç–æ–º

### 3. –¢—Ä–æ—Ç—Ç–ª–∏–Ω–≥ onHeartbeat
- **–§–∞–π–ª**: `src/location.js`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: –õ–∏–º–∏—Ç 60s –º–µ–∂–¥—É –≤—ã–∑–æ–≤–∞–º–∏ heartbeat

### 4. –£–ª—É—á—à–µ–Ω–Ω—ã–µ –ª–æ–≥–∏ BG
- **–§–∞–π–ª—ã**: `src/location.js`, `src/services/bgGeo/location.ts`
- **–ò–∑–º–µ–Ω–µ–Ω–∏—è**: –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è BG –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞

## üß™ –ü–ª–∞–Ω —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –®–∞–≥ 1: –ë–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
cd WorkforceTracker
npx react-native run-android

# –°–æ–∑–¥–∞—Ç—å —Å–Ω–∏–º–æ–∫ –ª–æ–≥–æ–≤
./monitor_logs_safe.sh
```

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
1. **–û—Ç–∫—Ä—ã—Ç—å MainScreen** ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ—Ç —Å–ø–∞–º–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞–∂–¥—ã–µ 200-300–º—Å
2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**:
   - `[ShiftPoll]` —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 15s
   - –ù–µ—Ç –º–∞—Å—Å–æ–≤—ã—Ö `Stop heartbeat`
   - –ï—Å—Ç—å `[BG] state enabled: true` –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ

### –®–∞–≥ 3: –¢–µ—Å—Ç BG —Ç—Ä–µ–∫–∏–Ω–≥–∞
1. **–í–∫–ª—é—á–∏—Ç—å —Ç–µ—Å—Ç-—Ä–µ–∂–∏–º**:
   ```bash
   # –í .env —Ñ–∞–π–ª–µ
   BG_TEST_FORCE_TRACKING=1
   ```
2. **–ù–∞–∂–∞—Ç—å "Start Test Tracking"** –≤ Debug —ç–∫—Ä–∞–Ω–µ
3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏**:
   - `[BG] ‚úÖ TEST Background tracking is ACTIVE`
   - –ü–æ—è–≤–ª–µ–Ω–∏–µ `onLocation` —Å–æ–±—ã—Ç–∏–π
   - HTTP –∑–∞–ø—Ä–æ—Å—ã –ø—Ä–∏ –æ–Ω–ª–∞–π–Ω–µ

### –®–∞–≥ 4: –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ª–æ–≥–æ–≤
```bash
# –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (—Å–ø–∞–º –∫–∞–∂–¥—ã–µ 200-300–º—Å)
cat bggeo_snapshot_20250906_111414.log | grep "Shift status API response" | wc -l

# –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π (–º–∞–∫—Å–∏–º—É–º –∫–∞–∂–¥—ã–µ 15s)
cat bggeo_after_poll_fix_*.log | grep "Shift status API response" | wc -l
```

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### ‚úÖ –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- –ó–∞–ø—Ä–æ—Å—ã —Å—Ç–∞—Ç—É—Å–∞ —Å–º–µ–Ω—ã –Ω–µ —á–∞—â–µ 1 —Ä–∞–∑–∞ –≤ 15 —Å–µ–∫—É–Ω–¥
- –ù–µ—Ç –º–∞—Å—Å–æ–≤—ã—Ö `Stop heartbeat` —Å–æ–æ–±—â–µ–Ω–∏–π
- BG —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å `enabled: true`
- –ü–æ—è–≤–ª—è—é—Ç—Å—è `onLocation` —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏ —Ç–µ—Å—Ç-—Ç—Ä–µ–∫–∏–Ω–≥–µ

### ‚ùå –ù–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
- –°–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–∞–∂–¥—ã–µ 200-300–º—Å
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ `setInterval` –≤ –ª–æ–≥–∞—Ö
- –ü–æ—Å—Ç–æ—è–Ω–Ω—ã–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ heartbeat
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–µ–æ–¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ–º —Ç—Ä–µ–∫–∏–Ω–≥–µ

## üêõ –ï—Å–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã –æ—Å—Ç–∞–ª–∏—Å—å

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–ª–µ—Ä–æ–≤**:
   ```bash
   adb logcat -d | grep "startPolling\|setInterval" | wc -l
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ WebSocket (—É–¥–∞–ª–µ–Ω—ã)**:
   ```bash
   adb logcat -d | grep "WebSocket" | wc -l
   # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å 0 - WebSocket —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞
   ```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å BG —Å–æ—Å—Ç–æ—è–Ω–∏–µ**:
   ```bash
   adb logcat -d | grep "BG.*state enabled" | tail -5
   ```

## üìù –û—Ç—á–µ—Ç –æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏

–ü–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø–æ–ª–Ω–∏—Ç–µ:

- [ ] –°–ø–∞–º –∑–∞–ø—Ä–æ—Å–æ–≤ —É—Å—Ç—Ä–∞–Ω–µ–Ω (–º–∞–∫—Å–∏–º—É–º 1 —Ä–∞–∑ –≤ 15s)
- [ ] Stop heartbeat –Ω–µ –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –º–∞—Å—Å–æ–≤–æ
- [ ] BG —Å—Ç–∞—Ä—Ç—É–µ—Ç —Å enabled: true
- [ ] –¢–µ—Å—Ç-—Ç—Ä–µ–∫–∏–Ω–≥ —Ä–∞–±–æ—Ç–∞–µ—Ç (–µ—Å—Ç—å onLocation —Å–æ–±—ã—Ç–∏—è)
- [ ] –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ª–æ–≥–æ–≤ —É–º–µ–Ω—å—à–∏–ª–æ—Å—å

**–§–∞–π–ª —Å –ª–æ–≥–∞–º–∏ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π**: `bggeo_after_poll_fix_*.log`

