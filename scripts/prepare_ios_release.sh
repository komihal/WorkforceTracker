#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ –≤ App Store

set -e

echo "üöÄ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ iOS –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –∫–æ—Ä–Ω–µ–≤—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd "$(dirname "$0")/.."

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
if [ ! -f "package.json" ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤—ã –Ω–∞—Ö–æ–¥–∏—Ç–µ—Å—å –≤ –∫–æ—Ä–Ω–µ–≤–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞."
    exit 1
fi

echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
npm install

echo "üßπ –û—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ Metro..."
npx react-native start --reset-cache &
METRO_PID=$!
sleep 5
kill $METRO_PID 2>/dev/null || true

echo "üì± –ü–µ—Ä–µ—Ö–æ–¥ –≤ iOS –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é..."
cd ios

echo "üçé –£—Å—Ç–∞–Ω–æ–≤–∫–∞ CocoaPods –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pod install

echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –¥–ª—è release —Å–±–æ—Ä–∫–∏..."

# –°–æ–∑–¥–∞–µ–º —Å—Ö–µ–º—É –¥–ª—è release –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
if [ ! -f "WorkforceTracker.xcodeproj/xcshareddata/xcschemes/WorkforceTracker.xcscheme" ]; then
    echo "üìã –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã –¥–ª—è release..."
    # –°—Ö–µ–º–∞ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –æ—Ç–∫—Ä—ã—Ç–∏–∏ –≤ Xcode
fi

echo "‚úÖ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ WorkforceTracker.xcworkspace –≤ Xcode"
echo "2. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ö–µ–º—É 'WorkforceTracker' –∏ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ 'Any iOS Device (arm64)'"
echo "3. –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö –ø—Ä–æ–µ–∫—Ç–∞ (WorkforceTracker target):"
echo "   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Development Team –≤ —Ä–∞–∑–¥–µ–ª–µ Signing & Capabilities"
echo "   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Bundle Identifier: com.workforcetracker.app"
echo "   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–µ—Ä—Å–∏—é –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (Marketing Version)"
echo "4. –î–æ–±–∞–≤—å—Ç–µ –∏–∫–æ–Ω–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Images.xcassets/AppIcon.appiconset/"
echo "5. –í—ã–±–µ—Ä–∏—Ç–µ Product > Archive –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∞—Ä—Ö–∏–≤–∞"
echo "6. –ó–∞–≥—Ä—É–∑–∏—Ç–µ –∞—Ä—Ö–∏–≤ –≤ App Store Connect —á–µ—Ä–µ–∑ Xcode Organizer"
echo ""
echo "‚ö†Ô∏è  –í–∞–∂–Ω–æ: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å:"
echo "   - Apple Developer Account"
echo "   - –°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç—ã –¥–ª—è —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è"
echo "   - Provisioning Profile –¥–ª—è App Store"
echo "   - –ò–∫–æ–Ω–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤"
